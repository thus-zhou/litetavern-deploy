# LiteTavern Pro 使用说明文档 (v4.0)

本文档旨在为用户提供 **LiteTavern Pro** 的完整安装与使用指南。

**版本特性 (v4.0):**
*   ☁️ **混合云部署**: 支持 Render 云端部署 (24小时在线) 与 本地/远程混合模式。
*   ⚡ **电量计费系统**: 引入 Power (电量) 概念，精确计费，支持多种模型差异化定价。
*   💳 **安全充值中心**: 独创“充值码”机制，无需绑定银行卡，安全灵活。
*   🛡️ **企业级风控**: 邮箱验证 + **邀请码注册系统** (解决邮件发送失败问题)。
*   👥 **多用户社区**: 支持账号注册/登录，数据云端隔离同步。
*   👑 **管理员控制台**: 全中文界面，支持模型连接测试、邀请码管理、用户监控。
*   🎨 **全中文界面**: 界面深度汉化，操作更亲切。

---

## 目录
1. [启动方式 (选择适合您的模式)](#1-启动方式-选择适合您的模式)
2. [云端部署 (永久在线)](#2-云端部署-永久在线)
3. [用户指南 (普通用户)](#3-用户指南-普通用户)
    *   [注册 (邮件/邀请码)](#31-注册-邮件邀请码)
    *   [我的钱包与充值](#32-我的钱包与充值)
    *   [角色与对话](#33-角色与对话)
4. [管理员指南 (Admin)](#4-管理员指南-admin)
    *   [进入后台](#41-进入后台)
    *   [模型配置与连接测试](#42-模型配置与连接测试)
    *   [发卡与充值管理](#43-发卡与充值管理)
    *   [注册邀请码与安全](#44-注册邀请码与安全)
5. [常见问题](#5-常见问题)

---

## 1. 启动方式 (选择适合您的模式)

本项目提供了三种启动脚本，请根据需求选择：

### 🏠 模式 A: 纯本地游玩 (推荐)
*   **脚本**: 双击 **`start_game.bat`**
*   **特点**: 启动速度最快，仅限本机访问。
*   **地址**: `http://localhost:8000`

### 🔗 模式 B: 远程分享 (PC开机)
*   **脚本**: 双击 **`share_app.bat`**
*   **特点**: 生成公网链接，发给朋友或在异地访问家中电脑。
*   **地址**: 启动后窗口会显示 `https://xxxx.trycloudflare.com`。

### 📱 模式 C: 局域网同步 (躺在床上玩)
*   **脚本**: 双击 **`start_mobile_server.bat`**
*   **特点**: 仅限同一 Wi-Fi 下的设备访问。
*   **地址**: 启动后会显示类似 `http://192.168.1.5:8000` 的地址。

---

## 2. 云端部署 (永久在线)

如果您希望服务 24 小时在线，无需开启电脑，请参考专门的部署指南：
👉 **[点击查看 DEPLOY_GUIDE.md](DEPLOY_GUIDE.md)**

---

## 3. 用户指南 (普通用户)

### 3.1 注册 (邮件/邀请码)
*   **注册**: 点击 "Sign Up" (注册)。
*   **方式一 (邮箱验证)**: 输入邮箱，点击“发送验证码”。
    *   *注意*: 云端部署时 QQ 邮箱可能拦截，请检查垃圾箱。
*   **方式二 (邀请码)**: 如果收不到邮件，点击底部的 **"Have an Invite Code?"**。
    *   输入管理员提供的 **邀请码 (Invite Code)**，即可直接跳过验证完成注册。
*   **奖励**: 注册成功即送 **500 电量**。

### 3.2 我的钱包与充值
LiteTavern 使用 **电量 (Power)** 作为消耗单位。
1.  点击侧边栏的 **钱包图标 (Wallet)**。
2.  **查看余额**: 顶部显示当前剩余电量。
3.  **充值**:
    *   查看下方的 **"充值说明"**，根据管理员的指引购买充值码。
    *   在输入框中填入 **充值码 (CD-Key)**。
    *   点击 **"立即兑换"**。

### 3.3 角色与对话
*   **选择模型**: 在 **设置 (Settings)** 中选择 AI 模型 (如 GPT-3.5, DeepSeek)。不同模型价格不同。
*   **创建角色**: 点击 **用户图标 (Users)**，创建或导入角色卡。
*   **开始聊天**: 发送消息，系统自动扣费。

---

## 4. 管理员指南 (Admin)

预设账号: `admin` / `admin123`

### 4.1 进入后台
1.  登录后，点击侧边栏底部的 **盾牌图标 (Shield)**。
2.  进入全中文管理后台。

### 4.2 模型配置与连接测试
进入 **“模型设置”** 标签：
*   **配置**: 修改 API Key、API URL。
*   **自动保存**: 修改后点击空白处即可自动保存。
*   **⚡ 测试连接**: 点击绿色的测试按钮，系统会发送 1 token 的请求验证配置是否正确。

### 4.3 发卡与充值管理
进入 **“商店与安全”** 标签 -> **“生成充值卡”**：
*   输入数量和面值，点击生成。
*   将卡密发送给用户。

### 4.4 注册邀请码与安全
进入 **“商店与安全”** 标签 -> **“注册邀请码”**：
*   **生成邀请码**: 当邮件服务不可用时，生成邀请码发给新用户。
*   **注册熔断**: 关闭“开放注册”开关，可暂停所有新用户注册。

---

## 5. 常见问题

*   **Q: 云端部署无法发送邮件？**
    *   A: 云服务器 IP 常被屏蔽。请使用 **邀请码** 功能让用户注册，或参考 `DEPLOY_GUIDE.md` 优化 SMTP 配置。
*   **Q: 启动脚本报错 "ModuleNotFoundError"？**
    *   A: 请确保使用新版的 `share_app.bat` 或 `start_game.bat`，它们会自动修复环境依赖。
*   **Q: 如何修改管理员密码？**
    *   A: 可以在数据库修改，或等待后续版本更新“修改密码”功能。

---

**祝您运营愉快！🎉**
