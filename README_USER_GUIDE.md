# LiteTavern Pro 使用说明文档 (v3.5)

本文档旨在为用户提供 **LiteTavern Pro** 的完整安装与使用指南。无论您是管理员还是普通用户，跟随本文档即可快速上手这一功能强大的 AI 角色扮演平台。

**版本特性 (v3.5):**
*   ⚡ **电量计费系统**: 引入 Power (电量) 概念，精确计费，支持多种模型差异化定价。
*   💳 **安全充值中心**: 独创“充值码”机制，无需绑定银行卡，安全灵活。
*   🛡️ **企业级风控**: 邮箱验证、IP 频次限制、一键熔断注册，全方位防刷。
*   👥 **多用户社区**: 支持账号注册/登录，数据云端隔离同步。
*   👑 **管理员控制台**: 可视化管理用户、发卡、配置模型参数及监控系统状态。
*   🎭 **深度角色扮演**: 支持角色标签、当前事件、性格详情及示例对话。
*   🌍 **世界书 (World Info)**: 全局设定注入，打造沉浸式世界观。
*   🎨 **全中文界面**: 界面深度汉化，操作更亲切。

---

## 目录
1. [环境准备与安装](#1-环境准备与安装)
2. [启动程序](#2-启动程序)
3. [用户指南 (普通用户)](#3-用户指南-普通用户)
    *   [注册与登录](#31-注册与登录)
    *   [我的钱包与充值](#32-我的钱包与充值)
    *   [角色与对话](#33-角色与对话)
4. [管理员指南 (Admin)](#4-管理员指南-admin)
    *   [进入后台](#41-进入后台)
    *   [模型与定价管理](#42-模型与定价管理)
    *   [发卡与充值管理](#43-发卡与充值管理)
    *   [安全与风控](#44-安全与风控)
5. [远程访问 (手机端)](#5-远程访问-手机端)
6. [常见问题](#6-常见问题)

---

## 1. 环境准备与安装

在开始之前，请确保您的电脑已安装以下基础软件。

### 1.1 安装环境
*   **Node.js**: [下载](https://nodejs.org/) (推荐 LTS 版本) - 用于前端界面。
*   **Python**: [下载](https://www.python.org/downloads/) (推荐 3.10+) - 用于后端服务。
    *   *注意*: 安装 Python 时务必勾选 **"Add Python to PATH"**。

### 1.2 安装依赖
双击运行根目录下的 `install_script.py` (或者在命令行运行 `python install_script.py`)，脚本会自动安装所有必要的依赖库。

---

## 2. 启动程序

### 一键启动
双击根目录下的 **`start_game.bat`** 即可。
*   系统会自动编译最新前端代码。
*   启动后端 API 服务。
*   自动打开浏览器访问 `http://localhost:8000`。

---

## 3. 用户指南 (普通用户)

### 3.1 注册与登录
*   **注册**: 首次使用需点击 "Sign Up" (注册)。
    *   输入用户名、密码及**邮箱**。
    *   点击 **"发送验证码"**，验证码将发送至您的邮箱 (测试环境下请查看后台黑色窗口)。
    *   输入验证码完成注册，系统赠送 **500 电量**。
*   **登录**: 使用注册的账号登录。

### 3.2 我的钱包与充值
LiteTavern 使用 **电量 (Power)** 作为消耗单位。
1.  点击侧边栏的 **钱包图标 (Wallet)**。
2.  **查看余额**: 顶部显示当前剩余电量。
3.  **充值**:
    *   查看下方的 **"充值说明"**，根据管理员的指引购买充值码。
    *   在输入框中填入 **充值码 (CD-Key)** (如 `LT-XXXX-...`)。
    *   点击 **"立即兑换"**，电量即刻到账。

### 3.3 角色与对话
*   **选择模型**: 在 **设置 (Settings)** 中选择您想使用的 AI 模型。不同模型消耗的电量不同 (如 GPT-3.5 便宜，GPT-4 昂贵)。
*   **创建角色**: 点击 **用户图标 (Users)**，可以创建或导入角色卡。支持设置详细的“人设”、“当前场景”和“示例对话”。
*   **开始聊天**: 发送消息，系统会自动扣除相应电量。如果电量不足，请及时充值。

---

## 4. 管理员指南 (Admin)

系统预设超级管理员账号：
*   **用户名**: `admin`
*   **密码**: `admin123`

### 4.1 进入后台
1.  使用 admin 账号登录。
2.  点击侧边栏底部的 **盾牌图标 (Shield)** 进入控制台。

### 4.2 模型与定价管理
进入后台 -> 点击 **Models** 标签：
*   **配置模型**: 您可以添加或修改模型的 API Key、API URL (支持 OpenAI, DeepSeek 等)。
*   **定价策略**: 修改 **Power Cost** 字段，设定该模型每次对话消耗的电量值 (如 10 或 100)。
*   **普通用户不可见**: 所有的 Key 和 URL 对普通用户严格保密，他们只能看到模型名称和价格。

### 4.3 发卡与充值管理
进入后台 -> 点击 **Shop & Safety** 标签：
*   **生成充值码**: 输入生成数量 (如 10 张) 和面值 (如 1000 点)，点击生成。
*   **售卖**: 将生成的 `LT-` 开头的代码复制下来，通过任何渠道 (微信/支付宝/闲鱼) 发送给付款用户。
*   **配置说明**: 修改 **Shop Announcement**，设置用户在钱包界面看到的购买指引 (如“请加群 xxxxx 购买”)。

### 4.4 安全与风控
在 **Shop & Safety** 标签下：
*   **注册熔断**: 遇到恶意注册攻击时，点击 **Open Registration** 开关将其关闭。此时所有新注册请求将被拒绝，老用户不受影响。
*   **用户管理**: 在 **Users** 标签下，您可以查看所有用户的余额、IP 地址及聊天记录，必要时可重置密码。

---

## 5. 远程访问 (手机端)

程序启动后，会在 **设置 (Settings)** 面板顶部显示远程访问地址。
*   **Cloudflare 模式**: 推荐使用，速度快，无需密码。
*   手机扫描二维码，即可在手机浏览器中继续与角色畅聊。

---

## 6. 常见问题

*   **Q: 为什么注册时收不到验证码？**
    *   A: 当前为开发环境，验证码会直接打印在**后台启动窗口** (黑色的命令行界面) 中，请查看 `📧 [Mock Email Service]` 字样。
*   **Q: 普通用户能看到 API Key 吗？**
    *   A: 不能。所有敏感信息仅管理员可见，用户只能消耗电量使用模型。
*   **Q: 如何修改管理员密码？**
    *   A: 可以在数据库或后台代码中修改，建议部署后第一时间修改默认密码。

---

**祝您运营愉快！🎉**
